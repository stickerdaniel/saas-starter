name: Static Checks

on:
  push:
    branches: [main]
  pull_request:

jobs:
  lint-format:
    name: Lint & Format
    runs-on: ubicloud-standard-2
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6
      - uses: oven-sh/setup-bun@3d267786b128fe76c2f16a390aa2448b815359f3 # v2
      - run: bun install
      - run: bun run lint
      - run: bun run format --check

  typecheck:
    name: Type Check
    runs-on: ubicloud-standard-2
    env:
      PUBLIC_CONVEX_URL: https://placeholder.convex.cloud
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6
      - uses: oven-sh/setup-bun@3d267786b128fe76c2f16a390aa2448b815359f3 # v2
      - run: bun install
      - run: bun scripts/build-emails.ts
      - run: bun run check

  spell-check:
    name: Spell Check
    runs-on: ubicloud-standard-2
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6
      - uses: actions/setup-go@4b73464bb391d4059bd26b0524d20df3927bd417 # v6
        with:
          go-version: 'stable'
      - run: go install github.com/client9/misspell/cmd/misspell@latest
      - name: Run misspell (excluding i18n)
        run: |
          find . -type f \
            -not -path './node_modules/*' \
            -not -path './.git/*' \
            -not -path './src/i18n/*' \
            -not -path './.svelte-kit/*' \
            -not -path './convex/_generated/*' \
            | xargs misspell -error
